FROM quay.io/fedora/fedora-bootc:42

# Add metadata to container
LABEL org.bootc.image-version="1.0"
LABEL org.bootc.os-type="fedora"
LABEL org.bootc.init-system="systemd"

# Install Packages
RUN dnf install -y \
      dnf-plugins-core \
      'dnf5-command(config-manager)' \
      vim \
      git \
      fastfetch \
      nmstate \
      wget \
      @virtualization && \
    sudo dnf config-manager addrepo --from-repofile=https://rpm.releases.hashicorp.com/fedora/hashicorp.repo && \
    sudo dnf install -y terraform && \
    dnf clean all

# Enable SSH
RUN systemctl enable sshd

# Enable auto bootc updates
RUN systemctl enable bootc-fetch-apply-updates.timer

# Enable libvirt
RUN systemctl enable libvirtd

# Clone homelab repo
RUN cd /usr/share && sudo git clone https://github.com/cjcocokrisp/homelab.git

# Download Talos Image and convert it to qcow2
RUN mkdir -p /var/lib/libvirt/images

RUN wget -O /var/lib/libvirt/images/talos.qcow2 https://factory.talos.dev/image/376567988ad370138ad8b2698212367b8edcb69b5fd68c80be1f2ec7d603b4ba/v1.10.6/metal-amd64.qcow2
